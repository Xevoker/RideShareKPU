<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>User Profile – RideShare</title>
  <link rel="stylesheet" href="profile.css" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    /* Hide the default file input */
    #profilePicInput {
      display: none;
    }
    /* Cursor pointer on profile image to indicate clickable */
    #profileImage {
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    #profileImage:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #cc3333aa;
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo-container">
      <img src="a.jpg" class="logo-img" alt="Logo" />
      <h2>Ride<span>Share</span></h2>
    </div>
    <nav>
      <ul>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="profile.html" class="active">Profile</a></li>
        <li><a href="ride history.html">My Rides</a></li>
        <li><a href="messages.html">Messages</a></li>
        <li><a href="settings.html">Settings</a></li>
      </ul>
    </nav>
  </aside>

  <!-- MAIN -->
  <main class="main-content">
    <header class="header">
      <h1>Profile <span class="user-name">John Doe</span></h1>
      <div class="header-actions">
        <button class="btn-notify" title="Notifications"><i class="fas fa-bell"></i></button>
        <img src="a.jpg" class="user-avatar" alt="User Avatar" />
      </div>
    </header>

    <div id="deactivated-banner" class="deactivated-banner">Your account is deactivated. Reactivate in Settings.</div>

    <!-- PROFILE CARD -->
    <section class="profile-card">
      <img src="a.jpg" alt="User Avatar" class="profile-img" id="profileImage" title="Click to change profile picture" />
      <input type="file" id="profilePicInput" accept="image/*" />

      <div class="profile-details">
        <h2 class="profile-name">John Doe</h2>
        <p class="profile-role">🚗 Verified Driver & Community Helper</p>
        <p class="profile-bio" contenteditable="true" id="editableBio" aria-label="User biography">
          Passionate about sustainable commuting, John loves connecting with fellow KPU students to share rides and reduce carbon footprint. Always punctual and friendly, he’s earned a reputation for reliability and safety.
        </p>
        <button id="saveBioBtn" class="btn-action">Save Bio</button>
      </div>
    </section>

    <!-- PERSONAL INFO -->
    <section class="profile-info">
      <h2>Personal Information</h2>
      <div class="info-grid">
        <div class="info-item"><strong>Email:</strong> <span id="infoEmail">john.doe@example.com</span></div>
        <div class="info-item"><strong>Phone:</strong> <span id="infoPhone">+1 (604) 555-9876</span></div>
        <div class="info-item"><strong>Location:</strong> <span id="infoLocation">Surrey Campus, KPU</span></div>
        <div class="info-item"><strong>Member Since:</strong> <span id="infoMemberSince">February 2023</span></div>
        <div class="info-item"><strong>Preferred Contact:</strong> <span id="infoPreferredContact">Email</span></div>
        <div class="info-item"><strong>Vehicle:</strong> <span id="infoVehicle">2018 Toyota Prius</span></div>
        <div class="info-item"><strong>Date of Birth:</strong> <span id="infoDOB">N/A</span></div>
        <div class="info-item"><strong>Gender:</strong> <span id="infoGender">N/A</span></div>
        <div class="info-item"><strong>LinkedIn:</strong> <a href="#" id="infoLinkedIn" target="_blank" rel="noopener noreferrer">Not set</a></div>
        <div class="info-item"><strong>Emergency Contact Name:</strong> <span id="infoEmergencyName">N/A</span></div>
        <div class="info-item"><strong>Emergency Contact Phone:</strong> <span id="infoEmergencyPhone">N/A</span></div>
        <div class="info-item"><strong>Carpool Preferences:</strong> <span id="infoCarpoolPrefs">None</span></div>
      </div>

      <!-- Edit Profile Button -->
      <div class="edit-profile-btn-wrapper">
        <a href="edit.html" class="btn-action edit-profile-btn">Edit Profile</a>
      </div>
      
      <a href="ride history.html" class="btn-action view-history-btn">View Ride History</a>
    </section>

    <!-- ACHIEVEMENTS -->
    <section class="achievements">
      <h2>Achievements</h2>
      <ul id="achievementsList">
        <li>🌟 Completed over 80 rides safely</li>
        <li>🏅 Awarded "Top Driver" for 2024</li>
        <li>💬 4.9/5 Average passenger rating</li>
        <li>🚦 Zero cancellations in last 12 months</li>
      </ul>
    </section>

    <!-- PROFILE UPDATES -->
    <section class="profile-updates">
      <h2>Latest Updates</h2>
      <ul id="profileUpdatesList">
        <li>🚗 Hosted a successful carpool from Surrey to Langley on July 20, 2025.</li>
        <li>📝 Updated bio with new interests on July 18, 2025.</li>
        <li>🌐 Connected LinkedIn account for networking on July 12, 2025.</li>
        <li>📸 Changed profile picture to summer photo on July 10, 2025.</li>
      </ul>
    </section>

    <!-- SETTINGS -->
    <section class="profile-settings">
      <h2>Account Settings</h2>
      <a href="change password.html" class="btn-action">Change Password</a>
      <a href="privacy.html" class="btn-action">Privacy Options</a>
      <a href="logout.html" class="btn-action">Logout</a>
    </section>
  </main>

  <script>
    // Utility function to format dates nicely
    const formatDate = (dateStr) => {
      if (!dateStr) return 'N/A';
      const d = new Date(dateStr);
      return isNaN(d) ? 'N/A' : d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
    };

    // Load profile and updates on page load
    window.addEventListener('DOMContentLoaded', () => {
      const raw = localStorage.getItem('rideShareProfile');
      if (!raw) return;
      const profile = JSON.parse(raw);

      const safe = (txt, fb='N/A') => txt && txt.trim() !== '' ? txt : fb;

      document.querySelector('.profile-name').textContent = safe(profile.fullName || profile.displayName || 'John Doe');
      document.querySelector('.user-name').textContent = safe(profile.fullName || profile.displayName || 'John Doe');

      if (profile.deactivated) {
        document.getElementById('deactivated-banner').style.display = 'block';
      }

      document.getElementById('infoEmail').textContent = safe(profile.email);
      document.getElementById('infoPhone').textContent = safe(profile.phone);
      document.getElementById('infoLocation').textContent = safe(profile.location);
      document.getElementById('infoPreferredContact').textContent = safe(profile.preferredContact);
      document.getElementById('infoVehicle').textContent = safe(profile.vehicle, 'None');
      document.getElementById('infoDOB').textContent = formatDate(profile.dob);
      document.getElementById('infoGender').textContent = safe(profile.gender);

      const linkedin = document.getElementById('infoLinkedIn');
      if (profile.linkedin && profile.linkedin.trim() !== '') {
        linkedin.textContent = profile.linkedin;
        linkedin.href = profile.linkedin.startsWith('http') ? profile.linkedin : 'https://' + profile.linkedin;
      }

      document.getElementById('infoEmergencyName').textContent = safe(profile.emergencyName);
      document.getElementById('infoEmergencyPhone').textContent = safe(profile.emergencyPhone);
      if (Array.isArray(profile.carpoolPrefs) && profile.carpoolPrefs.length > 0) {
        document.getElementById('infoCarpoolPrefs').textContent = profile.carpoolPrefs.join(', ');
      }

      if (profile.bio && profile.bio.trim() !== '') {
        document.getElementById('editableBio').textContent = profile.bio;
      }

      if (profile.profilePic) {
        document.getElementById('profileImage').src = profile.profilePic;
      }
    });

    // File input and profile pic upload logic
    const profileImage = document.getElementById('profileImage');
    const profilePicInput = document.getElementById('profilePicInput');

    profileImage.addEventListener('click', () => {
      profilePicInput.click();
    });

    profilePicInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const base64Img = event.target.result;
        profileImage.src = base64Img;

        let profile = localStorage.getItem('rideShareProfile');
        profile = profile ? JSON.parse(profile) : {};
        profile.profilePic = base64Img;
        localStorage.setItem('rideShareProfile', JSON.stringify(profile));

        alert('Profile picture updated!');
      };
      reader.readAsDataURL(file);
    });

    // Bio editing
    const bioElem = document.getElementById('editableBio');
    const saveBtn = document.getElementById('saveBioBtn');
    saveBtn.style.display = 'none';

    bioElem.addEventListener('input', () => {
      saveBtn.style.display = 'inline-block';
    });

    saveBtn.addEventListener('click', () => {
      let profile = localStorage.getItem('rideShareProfile');
      profile = profile ? JSON.parse(profile) : {};
      profile.bio = bioElem.textContent.trim();
      localStorage.setItem('rideShareProfile', JSON.stringify(profile));
      alert('Profile bio saved!');
      saveBtn.style.display = 'none';
    });
  </script>
</body>
</html>
